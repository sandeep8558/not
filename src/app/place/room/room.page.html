<ion-header>
  <ion-toolbar>
    
    <ion-title *ngIf="place$ | async as place">{{place.place_name}}</ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="openForm()">
        <ion-icon slot="start" name="add-outline"></ion-icon>
        Add
      </ion-button>
    </ion-buttons>

  </ion-toolbar>
</ion-header>

<ion-content>

  <!-- Room Form -->
  <ion-list *ngIf="isRoomFormOpen">
    <form [formGroup]="roomForm" (ngSubmit)="saveRoom()" class="p-3">

      <ion-input
        type="text"
        fill="clear"
        label="Room Name"
        labelPlacement="floating"
        helperText="Enter a valid room name"
        errorText="Invalid room name"
        formControlName="room_name"
      ></ion-input>

      <ion-button fill="solid" expand="block" class="mt-3" type="submit" [disabled]="roomForm.invalid">{{roomForm.value["id"] ? 'Update Room' : 'Add Room'}}</ion-button>

      <ion-button fill="clear" expand="block" color="danger" size="small" (click)="closeForm()">
        <ion-label >Close Form</ion-label>
      </ion-button>

    </form>
  </ion-list>

  <!-- Rooms Accordian -->
  <ion-accordion-group [multiple]="false">
    
    <ion-accordion *ngFor="let room of rooms" [value]="'room'+room.id">

      <ion-item slot="header" color="light">
        <ion-label *ngIf="!config">{{room.room_name}}</ion-label>
        <ion-input *ngIf="config" [value]="room.room_name" (change)="changeRoomName(room, $event)"></ion-input>
      </ion-item>

      <div class="ion-no-padding" slot="content">
        
        <ion-list [inset]="false">

          <ion-item [button]="false" *ngFor="let app of room.appliances">
            <!-- <div class="row" *ngIf="config">
              <div class="col">{{app.appliance_name}}</div>
              <div class="col-6">

                <ion-buttons slot="end">
                  <ion-button>
                    <ion-icon name="create-outline"></ion-icon>
                  </ion-button>
                  <ion-button>
                    <ion-icon name="trash-outline"></ion-icon>
                  </ion-button>
                </ion-buttons>
              </div>
            </div> -->

            <ion-label *ngIf="config">{{app.appliance_name}}</ion-label>
            <ion-button *ngIf="config" slot="end" color="tertiary" (click)="editAppliance(app)"><ion-icon name="create-outline" ></ion-icon></ion-button>
            <ion-button *ngIf="config" slot="end" color="danger" (click)="presentApplianceDeleteAlert(app)"><ion-icon name="trash-outline" ></ion-icon></ion-button>

            <ion-toggle *ngIf="app.appliance_type == 'Switch' && !config" justify="space-between">{{app.appliance_name}}</ion-toggle>
            <ion-range *ngIf="app.appliance_type == 'Dimmer' && !config" labelPlacement="start" min="0" max="100" value="50" label="{{app.appliance_name}}"></ion-range>
          </ion-item>

        </ion-list>

        <div class="row g-3 px-3" *ngIf="config">
          <div class="col-12">
            <form [formGroup]="applianceForm" (ngSubmit)="saveAppliance(room.id, room.place_id)">
              <div class="row g-3 pt-3">
                <div class="col-12">
                  <ion-input formControlName="appliance_name" label="Appliance Name" type="text" label-placement="floating" fill="outline"></ion-input>
                </div>
                <div class="col-12">
                  <ion-select formControlName="appliance_type" label="Switch Type" label-placement="floating" fill="outline">
                    <ion-select-option value="Switch">Switch</ion-select-option>
                    <ion-select-option value="Dimmer">Dimmer</ion-select-option>
                  </ion-select>
                </div>
                <div class="col-12">
                  <ion-button [disabled]="applianceForm.invalid" expand="full" type="submit">Save Appliance</ion-button>
                </div>
              </div>
            </form>
          </div>
          <div class="col-12">
            <ion-button expand="block" fill="outline" shape="round" color="danger" size="small" (click)="deleteRoomAlert(room.id)">
              Delete Room
            </ion-button>
          </div>
        </div>

      </div>

    </ion-accordion>

  </ion-accordion-group>

  <div class="container text-center py-3">
    <ion-checkbox labelPlacement="end" (ionChange)="configure()" [checked]="config">Configure Rooms</ion-checkbox>
  </div>

</ion-content>